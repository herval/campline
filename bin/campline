#!/usr/bin/env ruby

require 'rubygems'
require "cli_config"
require "campline"

begin
  config = CliConfig.new
  config.load!
  stty_save = %x{stty -g}.chomp

  begin
    %x{stty -echo}
    puts "Type in your password:"
    password = $stdin.gets.strip
  ensure
    %x{stty echo}
  end

  Campline::Client.new(config.data.merge(:password => password)).listen!
rescue => e
  puts e.message
ensure
  system("stty", stty_save)
end
